# C 语言实现 Linux who 命令  
https://www.lanqiao.cn/courses/584  

## 实验内容  

UNIX 系统的正常运作需要使用大量与系统有关的数据文件，例如，口令文件 /etc/passwd 和组文件 /etc/group 就是经常被多个程序频繁使用的两个文件。用户每次登陆 UNIX 系统，以及每次执行 ls -l 命令时都要使用口令文件。本项目中 《用 C 语言实现 Linux who 命令》 就是这样一个需要调用系统数据文件的程序，只不过调用的是 /var/run/utmp和 /var/log/wtmp 文件而已。  
由于历史原因，这些数据文件都是 ASCII 文本文件，并且使用标准 I/O 库读这些文件。但是，对于较大的系统，顺序扫描口令文件很花费时间，我们需要能够以非 ASCII 文本格式存放这些文件，但仍向使用其他文本格式的应用程序提供接口。对于这些数据文件的可移植性接口的使用是本实验的主题。  

## 实验知识点  

- 了解who命令工作流程  
- 对两个系统数据文件 var/run/utmp和 /var/log/wtmp 的了解  
- 访问系统文件的接口函数 getutent、 endutent 、  
- 了解 utmp 的结构内容  

## 实验环境  

- vim编辑器  
- gcc编译器  

## 实验原理  

### who命令介绍  

who命令是显示目前登录系统的用户信息。执行who命令可得知目前有那些用户登入系统，单独执行who命令会列出登入帐号，使用的终端机，登入时间以及从何处登入或正在使用哪个X显示器。  

### 参数说明  

who -H或--heading：显示各栏位的标题信息列；
who -q或--count：只显示登入系统的帐号名称和总人数； 更多请参考: http://man.linuxde.net/who  

### 实现原理  

who的实现原理很简单，可以在命令手册里面查询。可以这样实现，读取utmp里边的内容，然后显示记录，最后关闭utmp，who命令就是一个很简单的体现吧，打开文件，保存文件id，根据文件id读取用户的登陆信息，显示在终端。  

## 实验步骤  


## 实验总结  

本项目重点在于从 Linux 系统数据文件中获取信息，这要利用这些良好的系统接口：  
getutent() 函数从文件utmp中，每次读取一个 struct utmp 的结构体。读取失败返回 NULL。
endutent() 函数关闭文件utmp。  